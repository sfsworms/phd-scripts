---
title: 'Analysis: NNK7'
output: html_document
date: "2023-01-19"
---

```{r setup, include=FALSE}
# Gets thing set up. Need the library, and some functions.

knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

source("C:/Users/worms/Dropbox/PhD/PhD-Scripts/CyclicPeptidePipeline/function.R")
```

# Introduction

This is the analysis of the NNK7 peptides from the drift experiment. The required datasets are created in the "peptideAnalysis.R" file. Given the size of the data frames, I'll treat them in turn. First the induced set. I'll load it without the stop codons to lighten the load. 


```{r load datasets echo=FALSE}
directory <- "C:/Users/worms/NGS Data/2022.06.07_drift_seq/90-666155004b/00_fastq/NNK/NNK7/counts_csv"
induced_set <- read.csv(file = paste(directory, "induced_set_NNK7.csv", sep = "/")) %>%
  na.omit() %>% 
  remove_stop_codons()

```

## Summary


```{r pressure, echo=TRUE}
summary(induced_set$enrichment_ratio)
```
We can see that in induced conditions, most peptides becomes slightly less common. Few are strongly purged (or they're purged so hard it's not seen?) Some are highly enriched. Interestingly, some are also encoded by MANY sequences (up to 10), so that's good. 

```{r echo = FALSE}
enrichment_threshold <- 0

very_induced_set <- induced_set %>% filter(enrichment_ratio > enrichment_threshold)

print(paste("In total, ",
            nrow(very_induced_set),
            " DNA sequences have an enrichment ratio of more than ",
            enrichment_threshold,
            "",
            sep = ""))
n_dna <- length(unique(very_induced_set$seq))
n_peptide <- length(unique(very_induced_set$peptide_seq))

table_counts <- table(very_induced_set$peptide_seq)

very_induced_set <- very_induced_set %>%
  mutate(pep_count = as.numeric(table_counts[peptide_seq]))

very_induced_set %>% 
  select(enrichment_ratio) %>%
  summary()

very_induced_set %>%
  filter(pep_count >= 3) %>% 
  select(enrichment_ratio) %>%
  summary()

ggplot(very_induced_set, aes(pep_count, enrichment_ratio_log)) + 
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE)

```




